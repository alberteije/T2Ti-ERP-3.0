create view view_fin_movimento_caixa_banco (
    id,
    id_banco_conta_caixa,
    nome_conta_caixa,
    nome_pessoa,
    data_lancamento,
    data_pago_recebido,
    mes_ano,
    historico,
    valor,
    descricao_documento_origem,
    operacao
) as

select
    cast(concat(cc.id, lp.id, pp.id) as unsigned) as id,
    cc.id as id_banco_conta_caixa,
    cc.nome as nome_conta_caixa,
    p.nome as nome_pessoa,
    lp.data_lancamento,
    pp.data_pagamento as data_pago_recebido,
    date_format(pp.data_pagamento, '%m/%Y') as mes_ano,
    pp.historico,
    pp.valor_pago as valor,
    doc.descricao as descricao_documento_origem,
    'S' as operacao

from 
    fin_parcela_pagar pp
    inner join fin_lancamento_pagar lp on (pp.id_fin_lancamento_pagar = lp.id)
    inner join banco_conta_caixa cc on (lp.id_banco_conta_caixa = cc.id)
    inner join fornecedor f on (lp.id_fornecedor = f.id)
    inner join pessoa p on (f.id_pessoa = p.id)
    inner join fin_documento_origem doc on (lp.id_fin_documento_origem = doc.id)

union

select
    cast(concat(cc.id, lr.id, pr.id) as unsigned) as id,
    cc.id as id_banco_conta_caixa,
    cc.nome as nome_conta_caixa,
    p.nome as nome_pessoa,
    lr.data_lancamento,
    pr.data_recebimento as data_pago_recebido,
    date_format(pr.data_recebimento, '%m/%Y') as mes_ano,
    pr.historico,
    pr.valor_recebido as valor,
    doc.descricao as descricao_documento_origem,
    'E' as operacao

from 
    fin_parcela_receber pr
    inner join fin_lancamento_receber lr on (pr.id_fin_lancamento_receber = lr.id)
    inner join banco_conta_caixa cc on (lr.id_banco_conta_caixa = cc.id)
    inner join cliente c on (lr.id_cliente = c.id)
    inner join pessoa p on (c.id_pessoa = p.id)
    inner join fin_documento_origem doc on (lr.id_fin_documento_origem = doc.id)

order by id_banco_conta_caixa, data_lancamento;
