CREATE VIEW VIEW_FIN_FLUXO_CAIXA(
	ID,
    ID_CONTA_CAIXA,
    NOME_CONTA_CAIXA,
    NOME_PESSOA,
	DATA_LANCAMENTO,
    DATA_VENCIMENTO,
    VALOR,
    CODIGO_SITUACAO,
	DESCRICAO_SITUACAO,
    OPERACAO)
AS

select
  CAST( CONCAT(LP.ID,PP.ID) as UNSIGNED) as ID, 
  CC.ID AS ID_CONTA_CAIXA, CC.NOME AS NOME_CONTA_CAIXA, P.NOME,
  LP.DATA_LANCAMENTO, PP.DATA_VENCIMENTO, 
  PP.VALOR, SP.SITUACAO, SP.DESCRICAO, 'S' AS OPERACAO
 
from 
  FIN_PARCELA_PAGAR PP 
	inner join FIN_LANCAMENTO_PAGAR LP on (PP.ID_FIN_LANCAMENTO_PAGAR = LP.ID)
	inner join BANCO_CONTA_CAIXA CC on (LP.ID_BANCO_CONTA_CAIXA = CC.ID)
	inner join FORNECEDOR F on (LP.ID_FORNECEDOR = F.ID) 
	inner join PESSOA P on (F.ID_PESSOA = P.ID)
	inner join FIN_STATUS_PARCELA SP on (PP.ID_FIN_STATUS_PARCELA = SP.ID)

where
  SP.SITUACAO = '01' or SP.SITUACAO = '04'

union

select
  CAST( CONCAT(LR.ID,PR.ID) as UNSIGNED) as ID, 
  CC.ID AS ID_CONTA_CAIXA, CC.NOME AS NOME_CONTA_CAIXA, P.NOME,
  LR.DATA_LANCAMENTO, PR.DATA_VENCIMENTO, 
  PR.VALOR, SP.SITUACAO, SP.DESCRICAO, 'E' AS OPERACAO
 
from 
  FIN_PARCELA_RECEBER PR 
	inner join FIN_LANCAMENTO_RECEBER LR on (PR.ID_FIN_LANCAMENTO_RECEBER = LR.ID)
	inner join BANCO_CONTA_CAIXA CC on (LR.ID_BANCO_CONTA_CAIXA = CC.ID)
	inner join CLIENTE C on (LR.ID_CLIENTE = C.ID) 
	inner join PESSOA P on (C.ID_PESSOA = P.ID)
	inner join FIN_STATUS_PARCELA SP on (PR.ID_FIN_STATUS_PARCELA = SP.ID)

where
  SP.SITUACAO = '01' or SP.SITUACAO = '04'

ORDER BY 1
;